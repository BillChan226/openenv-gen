{# Design Agent: Specification Formats #}

{% macro database_spec_format() %}
## spec.database.json Format

```json
{
    "tables": [
        {
            "name": "table_name",
            "description": "What this table stores",
            "columns": [
                {
                    "name": "id",
                    "type": "UUID",
                    "constraints": ["PRIMARY KEY", "DEFAULT gen_random_uuid()"],
                    "description": "Unique identifier"
                },
                {
                    "name": "created_at",
                    "type": "TIMESTAMP WITH TIME ZONE",
                    "constraints": ["NOT NULL", "DEFAULT NOW()"]
                }
            ],
            "indexes": ["column_name"],
            "unique_constraints": [["col1", "col2"]]
        }
    ],
    "relationships": [
        {
            "from_table": "table1",
            "from_column": "column",
            "to_table": "table2",
            "to_column": "id",
            "type": "many-to-one",
            "on_delete": "CASCADE|SET NULL|RESTRICT"
        }
    ],
    "seed_data": {
        "table_name": [
            {"column1": "value1", "column2": "value2"}
        ]
    }
}
```

### Guidelines
1. **Use UUIDs** for primary keys with `gen_random_uuid()`
2. **Add timestamps** - created_at, updated_at for all tables
3. **Include indexes** for frequently queried columns
4. **Define relationships** with proper foreign keys
5. **Provide seed data** - at least 5-10 records per table for testing
6. **Test users** - Include test users with bcrypt-hashed passwords
{% endmacro %}


{% macro api_spec_format() %}
## spec.api.json Format

```json
{
    "conventions": {
        "base_url": "/api",
        "auth_method": "JWT Bearer",
        "response_wrapper": {
            "success_format": {"success": true, "data": "T"},
            "error_format": {"success": false, "error": {"code": "ERROR_CODE", "message": "string"}}
        },
        "list_response": "data.items (always an array)",
        "pagination": {
            "query_params": ["limit", "offset"],
            "response_fields": ["pagination.total", "pagination.limit", "pagination.offset"]
        }
    },
    "auth": {
        "endpoints": [
            {
                "path": "/auth/register",
                "method": "POST",
                "auth_required": false,
                "frontendFunction": "registerUser",
                "request": {
                    "body": {"email": "string", "password": "string", "name": "string"}
                },
                "response": {
                    "200": {"success": true, "data": {"user": "User", "token": "string"}},
                    "400": {"success": false, "error": {"message": "Validation error"}}
                }
            }
        ]
    },
    "endpoints": [
        {
            "path": "/restaurants",
            "method": "GET",
            "summary": "List restaurants",
            "auth_required": false,
            "frontendFunction": "listRestaurants",
            "request": {
                "query": {"search": "string", "category": "string", "limit": "number", "offset": "number"}
            },
            "response": {
                "200": {"success": true, "data": {"items": "[Restaurant]", "pagination": "Pagination"}}
            }
        },
        {
            "path": "/restaurants/:id",
            "method": "GET",
            "summary": "Get single restaurant",
            "auth_required": false,
            "frontendFunction": "getRestaurant",
            "request": {
                "params": {"id": "UUID"}
            },
            "response": {
                "200": {"success": true, "data": "Restaurant"},
                "404": {"success": false, "error": {"code": "NOT_FOUND"}}
            }
        }
    ],
    "frontendApiContract": {
        "_comment": "Frontend api.js MUST export these exact function names",
        "functions": {
            "listRestaurants": "GET /api/restaurants -> data.items",
            "getRestaurant": "GET /api/restaurants/:id -> data",
            "getRestaurantMenu": "GET /api/restaurants/:id/menu -> data.items",
            "addToCart": "POST /api/cart/items -> data",
            "getCart": "GET /api/cart -> data (401 for guests is expected, return empty)",
            "checkout": "POST /api/checkout -> data.order"
        }
    },
    "schemas": {
        "Restaurant": {
            "id": "UUID",
            "name": "string",
            "rating": "number",
            "delivery_time_min": "number"
        }
    }
}
```

### CRITICAL Guidelines - FRONTEND/BACKEND ALIGNMENT

1. **frontendFunction is MANDATORY** - Exact function name frontend api.js exports
2. **frontendApiContract section** - Summary of ALL functions frontend MUST implement
3. **Response wrapper consistency** - ALL endpoints use `{success, data}` format
4. **List responses** - ALWAYS `data.items` (never `data` directly for lists)
5. **Error handling** - Guest accessing protected routes returns 401 with proper format
6. **HTTP Methods:** GET (retrieve), POST (create), PATCH (update), DELETE (remove)
7. **Auth endpoints required:** /auth/register, /auth/login, /auth/me, /auth/logout

### API Contract Checklist (MUST INCLUDE)

For EACH endpoint, document:
- [ ] Exact path with parameters (e.g., `/restaurants/:id`)
- [ ] HTTP method
- [ ] `frontendFunction` name (e.g., `getRestaurant`)
- [ ] Request format (params, query, body)
- [ ] Success response format (including wrapper)
- [ ] Error responses (401, 404, 500)
- [ ] Whether auth is required
{% endmacro %}


{% macro ui_spec_format() %}
## spec.ui.json Format

```json
{
    "theme": {
        "mode": "dark|light",
        "colors": {
            "primary": "#hex",
            "secondary": "#hex",
            "background": "#hex",
            "text": "#hex"
        },
        "typography": {
            "fontFamily": "font-stack",
            "headingFont": "font-name"
        }
    },
    "layout": {
        "type": "sidebar|topnav",
        "sidebarWidth": "250px",
        "headerHeight": "64px",
        "maxContentWidth": "1200px"
    },
    "pages": [
        {
            "path": "/",
            "fileName": "HomePage.jsx",
            "auth_required": false,
            "layout": "main",
            "components": ["CategoryPills", "RestaurantGrid"],
            "api_calls": [
                {
                    "apiFunction": "listRestaurants",
                    "endpoint": "/api/restaurants",
                    "method": "GET",
                    "responseExtract": "data.items"
                }
            ]
        },
        {
            "path": "/restaurants/:id",
            "fileName": "RestaurantPage.jsx",
            "auth_required": false,
            "components": ["RestaurantHeader", "MenuList"],
            "api_calls": [
                {
                    "apiFunction": "getRestaurant",
                    "endpoint": "/api/restaurants/:id",
                    "responseExtract": "data"
                },
                {
                    "apiFunction": "getRestaurantMenu",
                    "endpoint": "/api/restaurants/:id/menu",
                    "responseExtract": "data.items"
                }
            ]
        },
        {
            "path": "/login",
            "fileName": "LoginPage.jsx",
            "auth_required": false,
            "layout": "minimal",
            "components": ["LoginForm"]
        }
    ],
    "components": [
        {
            "name": "RestaurantGrid",
            "type": "display",
            "api_integration": {
                "apiFunction": "listRestaurants",
                "responseExtract": "data.items",
                "dataShape": "[{id, name, rating, image_url, delivery_time_min}]"
            },
            "states": ["default", "loading", "error", "empty"]
        }
    ],
    "pageFileNaming": {
        "_comment": "CRITICAL: Use consistent Page suffix naming",
        "pattern": "{Name}Page.jsx",
        "examples": [
            "HomePage.jsx (NOT Home.jsx)",
            "RestaurantPage.jsx (NOT Store.jsx or Restaurant.jsx)",
            "LoginPage.jsx (NOT Login.jsx)",
            "CheckoutPage.jsx (NOT Checkout.jsx)"
        ]
    }
}
```

### CRITICAL: Naming Consistency

**Page File Names:**
- ALWAYS use `{Name}Page.jsx` pattern
- Examples: `HomePage.jsx`, `RestaurantPage.jsx`, `CheckoutPage.jsx`
- NEVER: `Home.jsx`, `Store.jsx`, `Checkout.jsx`

**API Function Names:**
- MUST match `frontendFunction` in spec.api.json exactly
- Document `apiFunction` for each page's data fetching

### CRITICAL: API Integration
For EVERY component/page that fetches data:
1. Specify `apiFunction` name (MUST match spec.api.json frontendFunction)
2. Specify `responseExtract` path (e.g., `data.items`, `data`)
3. This ensures frontend knows exactly what to call and how to unwrap responses
{% endmacro %}

