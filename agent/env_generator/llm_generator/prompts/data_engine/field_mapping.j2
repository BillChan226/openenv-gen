{#
  Field Mapping Prompt

  Maps dataset fields to database schema columns.
  Generates appropriate transforms for type conversion.
#}

<TASK>
Map dataset fields to database columns. Generate appropriate transforms.
</TASK>

<AVAILABLE_TRANSFORMS>
- null: No transform needed
- float: Convert to float
- float:N: Convert to float, round to N decimals
- int: Convert to integer
- truncate:N: Truncate string to N characters
- json: Convert array/object to JSON string
- slugify: Convert to URL-friendly slug
- prefix:X: Add prefix X to value
- first: Get first element if array
- first_image: Extract first image URL from images array/object
- nested:field: Extract nested field (e.g., "nested:name" for {"name": "value"})
- datetime: Parse datetime string
- clean_html: Remove HTML tags
</AVAILABLE_TRANSFORMS>

<EXAMPLES>
Example 1 - E-commerce Products:
Target Schema:
- id (TEXT, primary key)
- name (TEXT, max 200 chars)
- price (REAL)
- description (TEXT)
- image (TEXT, URL)
- rating (REAL)
- category_id (TEXT)

Dataset Fields:
- parent_asin: "B00X4WHP5E"
- title: "Wireless Bluetooth Headphones with Noise Cancellation"
- price: 29.99
- description: ["High quality sound", "Noise cancelling", "Long battery life"]
- images: [{"large": "https://example.com/img1.jpg"}]
- average_rating: 4.5
- main_category: "Electronics"

Response:
```json
{
  "mappings": [
    {"source": "parent_asin", "target": "id", "transform": "prefix:prod-"},
    {"source": "title", "target": "name", "transform": "truncate:200"},
    {"source": "price", "target": "price", "transform": "float"},
    {"source": "description", "target": "description", "transform": "json"},
    {"source": "images", "target": "image", "transform": "first_image"},
    {"source": "average_rating", "target": "rating", "transform": "float:1"},
    {"source": "main_category", "target": "category_id", "transform": "slugify"}
  ],
  "unmapped_target": [],
  "unmapped_source": [],
  "confidence": 0.95,
  "notes": "Good field coverage. Images need extraction from nested array structure."
}
```

Example 2 - Social Media Posts:
Target Schema:
- id (TEXT)
- content (TEXT)
- author_name (TEXT)
- created_at (TIMESTAMP)
- likes_count (INTEGER)

Dataset Fields:
- tweet_id: "1234567890"
- text: "Hello world! This is a test tweet."
- user: {"name": "John Doe", "screen_name": "johndoe"}
- created_at: "2023-01-15T10:30:00Z"
- favorite_count: 42

Response:
```json
{
  "mappings": [
    {"source": "tweet_id", "target": "id", "transform": null},
    {"source": "text", "target": "content", "transform": null},
    {"source": "user", "target": "author_name", "transform": "nested:name"},
    {"source": "created_at", "target": "created_at", "transform": "datetime"},
    {"source": "favorite_count", "target": "likes_count", "transform": "int"}
  ],
  "unmapped_target": [],
  "unmapped_source": ["user.screen_name"],
  "confidence": 0.90,
  "notes": "User object is nested, extracting name field. screen_name not mapped."
}
```

Example 3 - News Articles:
Target Schema:
- id (TEXT)
- title (TEXT)
- content (TEXT)
- author (TEXT)
- published_at (TIMESTAMP)
- category (TEXT)

Dataset Fields:
- article_id: "abc123"
- headline: "Breaking News: Major Event"
- body: "<p>Full article text here...</p>"
- author_name: "Jane Reporter"
- publish_date: "2023-06-20"
- section: "World"

Response:
```json
{
  "mappings": [
    {"source": "article_id", "target": "id", "transform": null},
    {"source": "headline", "target": "title", "transform": null},
    {"source": "body", "target": "content", "transform": "clean_html"},
    {"source": "author_name", "target": "author", "transform": null},
    {"source": "publish_date", "target": "published_at", "transform": "datetime"},
    {"source": "section", "target": "category", "transform": "slugify"}
  ],
  "unmapped_target": [],
  "unmapped_source": [],
  "confidence": 0.95,
  "notes": "Direct mappings available. HTML cleaned from body content."
}
```
</EXAMPLES>

<TARGET_SCHEMA>
{{ target_schema }}
</TARGET_SCHEMA>

<DATASET_FIELDS>
{{ dataset_fields }}
</DATASET_FIELDS>

<OUTPUT_FORMAT>
Respond with ONLY valid JSON (no markdown code blocks):
{
  "mappings": [
    {"source": "field_name", "target": "column_name", "transform": "transform_spec or null"}
  ],
  "unmapped_target": ["columns without source mapping"],
  "unmapped_source": ["fields without target mapping"],
  "confidence": 0.0-1.0,
  "notes": "Brief notes about the mapping"
}
</OUTPUT_FORMAT>
